---
title: 'About Bloom Filter, Merkle Tree, MPT'
date: '2022-05-22'
lastmod: '2022-05-22'
tags: ['Cryptography', 'Bloom-Filter', 'Merkle-Tree', 'MPT']
draft: false
summary: 'ë¸”ë¡ì²´ì¸ì—ì„œì˜ ë°ì´í„° ê²€ì¦ì„ ìœ„í•œ ìë£Œ êµ¬ì¡°ë“¤ Bloom-Filter, Merkle Tree, MPTì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤. ğŸ¤”'
images: ['/static/images/thumbnail/cryptography.png']
canonicalUrl: 'https://min71.dev/posts/cryptography-data-structure-for-verification'
---

<TOCInline toc={props.toc} exclude="Introduction" />

## Bloom Filter

**íŠ¹ì • ì§‘í•©ì— ì†í•˜ëŠ” ë°ì´í„°ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆëŠ” í™•ë¥ ì  ìë£Œêµ¬ì¡°ì…ë‹ˆë‹¤.**

### Bloom Filter íŠ¹ì§•

- _N bit ë°°ì—´ê³¼ Mê°œì˜ í•´ì‹œ í•¨ìˆ˜ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, í•´ì‹œ í•¨ìˆ˜ë“¤ì€ ì €ì¥í•˜ë ¤ëŠ” ê° ìš”ì†Œë¥¼ ë°°ì—´ì˜ ë‹¤ë¥¸ ìœ„ì¹˜ì— ë§¤í•‘í•©ë‹ˆë‹¤._

- _ë°ì´í„°ê°€ ì¶”ê°€ë  ë•Œ, Mê°œì˜ í•´ì‹œ í•¨ìˆ˜ëŠ” ê°ê° ì´ ìš”ì†Œì— ëŒ€í•´ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ë©°, ìƒì„±ëœ ëª¨ë“  ì¸ë±ìŠ¤ì— í•´ë‹¹í•˜ëŠ” ë¹„íŠ¸ëŠ” 1ë¡œ ì„¤ì •ë©ë‹ˆë‹¤._

- _íŠ¹ì • íŒ¨í„´ì„ ì‚¬ìš©í•œ í•´ì‹œ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ë°°ì—´ì¤‘ í•˜ë‚˜ë¥¼ ê°€ë¥´í‚¤ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ **ëª¨ë‘ 1ì„ ê°€ë¥´í‚¤ëŠ” ê²½ìš° ìˆì„ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²ƒ**ì„ ì˜ë¯¸í•˜ê³ , **í•œ ê°œë¼ë„ 0ì„ ê°€ë¥´í‚¤ë©´ í™•ì‹¤í•˜ê²Œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²ƒ**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.._

- _ë¸”ë£¸ í•„í„°ì˜ í•œê³„ëŠ” ê±°ì§“ ì–‘ì„±ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì¸ë°, ì¦‰ **ë°ì´í„°ê°€ ì‹¤ì œë¡œëŠ” ì§‘í•©ì— ì—†ì§€ë§Œ, ë¸”ë£¸ í•„í„°ì— ì˜í•´ ì¡´ì¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ì˜ëª» ì¸ì‹ë  ê°€ëŠ¥ì„±**ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜. **ê±°ì§“ ìŒì„±(false negatives)ì€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë°ì´í„°ê°€ ë¸”ë£¸ í•„í„°ì— ìˆë‹¤ê³  í‘œì‹œë˜ë©´ ê·¸ ë°ì´í„°ëŠ” í™•ì‹¤íˆ ì§‘í•©ì— í¬í•¨**ë˜ì–´ ìˆìŠµë‹ˆë‹¤._

> âœ“ **_N = 18, M = 3ì¸ Bloom Filter_**
>
> ![](/static/images/cryptography/bloom-filter.jpeg)

## Merkle tree

**ë¨¸í´ íŠ¸ë¦¬ëŠ” ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦ì— ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì´ì§„ í•´ì‹œ íŠ¸ë¦¬ êµ¬ì¡°ì´ë©°, ë¸”ë¡ì²´ì¸ ê¸°ìˆ ì—ì„œ ì´ ìë£Œêµ¬ì¡°ëŠ” ì£¼ë¡œ íŠ¸ëœì­ì…˜ ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.**

### Merkle tree íŠ¹ì§•

- _Binary Hash Treeêµ¬ì¡°ë¥¼ ê°–ê³  ìˆìœ¼ë©° ì´ êµ¬ì¡° ë•ë¶„ì— ê³„ì‚°ì´ ë‹¨ìˆœí•˜ê³  ë¹ ë¥´ë‹¤ëŠ” ì¥ì ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤._

- _[Merkle Path](http://wiki.hash.kr/index.php/%EB%A8%B8%ED%81%B4%EA%B2%BD%EB%A1%9C)ë¥¼ ì´ìš©í•´ íŠ¸ëœì­ì…˜ì´ ë¸”ë¡ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ì‰½ê²Œ íŒŒì•… ê°€ëŠ¥í•˜ë©°, íŠ¸ëœì­ì…˜ì˜ ë¬´ê²°ì„±ì„ ì¦ëª…í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë°ì´í„°ì˜ ì–‘ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤._

- _ë¦¬í”„ë…¸ë“œë“¤ì„ `concatenate operator`ë¥¼ í†µí•´ ê²°í•© í›„ í•´ì‹±í•˜ì—¬ ìƒìœ„ë…¸ë“œë¥¼ ìƒì„±í•˜ë©° ìµœì¢…ì ìœ¼ë¡œ ë‹¨ì¼ ë£¨íŠ¸ ë…¸ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤._

  â¤· âœ“ _íŠ¸ëœì­ì…˜ ìˆ˜ê°€ í™€ìˆ˜ì¼ ê²½ìš°ì—ëŠ” ë§ˆì§€ë§‰ íŠ¸ëœì­ì…˜ì˜ í•´ì‹œê°’ì„ ì¤‘ë³µìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ë…¸ë“œì˜ ìˆ˜ë¥¼ ì§ìˆ˜ë¡œ ë§ì¶¥ë‹ˆë‹¤._

---

> âœ“ **_Merkle tree_**
>
> ![](/static/images/cryptography/merkle-tree.png)

---

## Merkle Patricia Trie (MPT)

**Merkle Patricia Trieë€ ì´ë”ë¦¬ì›€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìë£Œêµ¬ì¡°ì´ë©° Merkle trieë¥¼ ë³€í˜•í•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.**

### íŠ¹ì§•

- _ê°ê°ì˜ ë…¸ë“œëŠ” **sha3ì„ ì´ìš©í•´ì„œ Hashing** í•©ë‹ˆë‹¤._

- _MPTëŠ” **key-value DB**ë¼ê³  ë³¼ ìˆ˜ ìˆìœ¼ë©° ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ í˜¸í™˜ë©ë‹ˆë‹¤.._

  â¤· _level DBì€ Go, C++, Python clientì—ì„œ ì‚¬ìš©ë˜ê³ , rocks DBì€ Parity clientì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤._

  â¤· _keyëŠ” ê° Nodeì˜ hashì´ê³  valueëŠ” ê° Nodeì˜ ê°’ì„ ì˜ë¯¸í•©ë‹ˆë‹¤._

- _Merkle Treeì²˜ëŸ¼ **í•˜ë‚˜ì˜ Nodeë¼ë„ ë³€ê²½ë  ê²½ìš° Root Hashì— ì˜í–¥ì„ ì£¼ê²Œ ë˜ì–´ ê°’ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._

### íƒ€ì…

- **NULL** : _NULLì€ ë¹ˆ ë¬¸ìì—´ê°’ì„ ì˜ë¯¸ í•©ë‹ˆë‹¤._

- **branch** : _16 ~ 17ê°œì˜ ìš”ì†Œë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ” ë°°ì—´ì…ë‹ˆë‹¤. 0 ~ 15ë²ˆ IndexëŠ” hashingëœ ì£¼ì†Œê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìœ¼ë©° `value`ê°€ ìˆëŠ”ê²½ìš°ì—ëŠ” ë§ˆì§€ë§‰ indexë¡œ `value`ì˜ ê°’ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤._

  â¤· _hashingëœ ì£¼ì†Œê°’ì€ indexì— ë§ì¶° ë“¤ì–´ê°‘ë‹ˆë‹¤._

- **leaf** : _2ê°œì˜ ìš”ì†Œë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ” ë°°ì—´ì´ë©° `encodedPath`ì™€ `value`ê°’ì´ ë“¤ì–´ê°€ ìˆìŠµë‹ˆë‹¤._

- **extension** : _2ê°œì˜ ìš”ì†Œë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ” ë°°ì—´ì´ë©° `encodedPath`ì™€ `key`ê°’ì´ ë“¤ì–´ê°€ ìˆìŠµã„´;ë‹¤._

### hex Prefix Encoding

> **extension Node ì™€ leaf Nodeë¥¼ êµ¬ë³„í•˜ê¸° ìœ„í•´ ì‚¬ìš©**

âœ“ _Merkle Patricia TrieëŠ” nibble ë‹¨ìœ„ë¡œ ì €ì¥ë©ë‹ˆë‹¤. nibbleì€ 4bit ì¦‰ 0.5byteì´ë©° hex charì—­ì‹œë„ 4bitì´ë©° 1byteë¡œ ë–¨ì–´ì§€ì§€ ì•Šì„ ê²½ìš° 1byteë¥¼ ë§ì¶”ê¸° ìœ„í•´ 0ì„ ì´ìš©í•˜ì—¬ paddingí•©ë‹ˆë‹¤._

| hex char |     node tpye      | path length |
| :------: | :----------------: | :---------: |
|    0     |     extension      |    even     |
|    1     |     extension      |     odd     |
|    2     | terminating (leaf) |    even     |
|    3     | terminating (leaf) |     odd     |

### ğŸ“ Example

<p style={{ fontSize:"1.2rem",fontWeight:"bold" }}>**âœ… ê°€ìƒì˜ path ì˜ˆì‹œ**</p>
<div style={{border:"1px solid #075985", padding: '0.5rem', margin:"0.5rem", marginTop:"1rem"}}>
- **\<64 6f>** : _"Kevin"_
- **\<64 6f 67>** : _"FODEN"_
- **\<64 6f 67 65>** : _"David"_
- **\<68 6f 72 73 65>** : _"YAYA"_
</div>

<p style={{ fontSize: '1.2rem', fontWeight: 'bold' }}>**âœ… ê°€ìƒì˜ key-value ê¸°ì¤€ trie ì˜ˆì‹œ**</p>

<div style={{border:"1px solid #075985", padding: '0.5rem', margin:"0.5rem"}}>
- _rootHash_ : **\[ < 16 >, hashA ]**

- _hashA_ : **[&lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , hashB, &lt;&gt; , &lt;&gt; , &lt;&gt; , hashC, &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; ]**

- _hashB_ : **\[ < 00 6f >, hashD ]**

- _hashC_ : **\[ < 20 6f 72 73 65 >, "YAYA"]**

- _hashD_ : **[&lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , hashE, &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , - lt;&gt; , "Kevin"]**

- _hashE_ : **\[ < 17 >, hashF]**

- _hashF_ : **[&lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , hashG, &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , &lt;&gt; , - &lt;&gt; , "FODEN"]**

- _hashG_ : **\[ &lt; 35 >, "David"]**

</div>

**_âœï¸ Example hash íŠ¹ì§•_**

> **hashA** : _branch Nodeì´ë©° `value`ê°€ ì¡´ì¬ì§€ ì•Šê¸° ë•Œë¬¸ì— 16ê°œì˜ hashingëœ ì£¼ì†Œê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” `index`ë¡œë§Œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤._
>
> **hashB, hashE** : _extension Nodeì´ë¯€ë¡œ `encodedPath`ì™€ `key`ë¡œë§Œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤._
>
> **hashC, hashG** : _leaf Nodeì´ë¯€ë¡œ `encodedPath`ì™€ `value`ë¡œë§Œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤._
>
> **hashD, hashF** : _branch Nodeì´ë©° `value`ê°€ ì¡´ì¬í•˜ë¯€ë¡œ 16ê°œì˜ hashingëœ ì£¼ì†Œê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” `index`ì™€ `value`ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤._
