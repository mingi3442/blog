name: Filter PR Contents

on:
  pull_request:
    types: [opened, synchronize]
    branches:
      - main

# PR ë¸Œëœì¹˜ í‘¸ì‹œ ê¶Œí•œ ë¶€ì—¬
permissions:
  contents: write
  pull-requests: write

jobs:
  filter-data-directory:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' && github.event.pull_request.base.ref == 'main'
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Reset data directory changes
        run: |
          # ë©”ì¸ ë¸Œëœì¹˜ì˜ data/ ë””ë ‰í† ë¦¬ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
          git fetch origin main:main

          # data ë””ë ‰í† ë¦¬ì˜ ë³€ê²½ì‚¬í•­ ë˜ëŒë¦¬ê¸°
          git checkout main -- data/

          # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
          if [[ -n "$(git status --porcelain)" ]]; then
            # ë³€ê²½ì‚¬í•­ ìˆìœ¼ë©´ ì»¤ë°‹
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git commit -am "ğŸ¤– Automatically exclude data/ directory changes"
            git push
          else
            echo "No changes in data/ directory, nothing to do."
          fi
